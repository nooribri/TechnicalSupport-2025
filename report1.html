 <!DOCTYPE html>
<html lang="ar">
<head>
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
<meta charset="UTF-8">
<title>ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„ÙÙ†ÙŠ</title>
<style>
  body {
    font-family: 'Cairo', sans-serif;
    margin: 20px;
    background-color: #fafafa;
  }

  h2, h3 {
    text-align: center;
    margin: 5px 0;
  }

  table {
    width: 100%;
    border-collapse: collapse;
    text-align: center;
    font-size: 13px;
    background-color: #ffffff;
    box-shadow: 0 2px 6px rgba(15, 23, 42, 0.06);
    border-radius: 6px;
    overflow: hidden;
  }

  th, td {
    border: 1px solid #e0e7ff;
    padding: 5px 6px;
  }

  /* Ø§Ù„ØµÙ Ø§Ù„Ø¹Ù„ÙˆÙŠ (Ø¹Ù†ÙˆØ§Ù† Ø±Ø¦ÙŠØ³ÙŠ) */
  thead tr:first-child {
    background: #8eb6e6;  /* Ø£Ø²Ø±Ù‚ Ø³Ù…Ø§ÙˆÙŠ ÙØ§ØªØ­ */
    color: #0f172a;       /* ÙƒØªØ§Ø¨Ø© Ø¯Ø§ÙƒÙ†Ø© Ù„Ù‚Ø±Ø§Ø¡Ø© Ø£ÙˆØ¶Ø­ */
    font-size: 14px;
  }

  /* ØµÙ Ø¹Ù†Ø§ÙˆÙŠÙ† Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© */
  thead tr:nth-child(2) {
    background: #cddffd;  /* Ø£Ø²Ø±Ù‚ Ø£ÙØªØ­ */
    font-weight: 600;
  }

  /* ØµÙÙˆÙ Ø§Ù„Ø²ÙˆØ¬ÙŠØ© */
  tbody tr:nth-child(even) {
    background: #f7fbff;  /* Ø±Ù…Ø§Ø¯ÙŠ Ù…Ø²Ø±Ù‚ ÙØ§ØªØ­ Ø¬Ø¯Ø§Ù‹ */
  }

  /* ØªØ£Ø«ÙŠØ± Ø¹Ù†Ø¯ Ø§Ù„Ù…Ø±ÙˆØ± Ø¨Ø§Ù„Ù…Ø§ÙˆØ³ */
  tbody tr:hover {
    background: #e8f3ff;
    transition: 0.3s;
  }

  .search-container {
    margin-bottom: 20px;
    text-align: center;
  }

  .search-container input {
    display: inline-block;
    margin: 5px;
    padding: 12px 40px 12px 12px;
    font-size: 16px;
    border-radius: 6px;
    border: 1px solid #d0d7ea;
    width: 320px;
    direction: rtl;
  }

  .buttons {
    margin: 15px 0;
    text-align: center;
  }

  button {
    background-color: #004c91;
    color: white;
    border: none;
    padding: 8px 14px;
    margin: 5px;
    border-radius: 6px;
    font-size: 14px;
    cursor: pointer;
  }

  button:hover {
    background-color: #006ad1;
  }

  @media print {
    .search-container,
    .buttons {
      display: none !important;
    }

    .header,
    #reportTable {
      display: block !important;
      width: 100%;
    }
  }
  .footer-meta {
  position: fixed;
  bottom: 10px;
  left: 10px;
  font-size: 12px;
  direction: rtl;
}

@media print {
  .footer-meta {
    position: fixed;
    bottom: 10px;
    left: 10px;
  }
}
table {
  width: 100%;
  border-collapse: collapse;
  text-align: center;
  font-size: 13px;
  background-color: #ffffff;
  box-shadow: 0 2px 6px rgba(15, 23, 42, 0.06);
  border-radius: 6px;
  overflow: hidden;
  direction: rtl;   /* ğŸ‘ˆ Ù‡Ø°Ø§ Ø§Ø®ØªÙŠØ§Ø±ÙŠØŒ Ø¨Ø³ ÙŠØ¶Ù…Ù† Ø£Ù† Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ù†ÙØ³Ù‡ RTL */
}
.actions{
  display: flex;
  gap: 8px;
  justify-content: center;
  align-items: center;
  white-space: nowrap;
}

.actions button{
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 6px;

  min-width: 95px;     /* Ù†ÙØ³ Ø§Ù„Ø¹Ø±Ø¶ */
  height: 34px;        /* Ù†ÙØ³ Ø§Ù„Ø§Ø±ØªÙØ§Ø¹ */
  padding: 0 10px;

  border: 1px solid transparent;
  border-radius: 8px;
  cursor: pointer;
  font-weight: 700;
  transition: transform .08s ease, filter .15s ease, box-shadow .15s ease;
}

/* ØªØ¹Ø¯ÙŠÙ„: Ø£Ø®Ø¶Ø± ÙØ§ØªØ­ */
.actions .btn-edit{
  background: #b9f6ca;
  color: #0b3d1a;
  border-color: #7be39a;
}

/* Ø­Ø°Ù: Ø£Ø­Ù…Ø± */
.actions .btn-delete{
  background: #ff4d4d;
  color: #fff;
  border-color: #ff2f2f;
}

/* ØªØ£Ø«ÙŠØ±Ø§Øª */
.actions button:hover{
  filter: brightness(0.96);
  box-shadow: 0 6px 14px rgba(0,0,0,0.12);
  transform: translateY(-1px);
}

.actions button:active{
  transform: translateY(0);
  box-shadow: none;
}

/* Ø§Ø®ØªÙŠØ§Ø±ÙŠ: ØªØµØºÙŠØ± Ø§Ù„Ù†Øµ Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„ØµØºÙŠØ±Ø© */
@media (max-width: 700px){
  .actions button span{ display:none; }
  .actions button{ min-width: 44px; padding: 0 8px; }
}

@media print {
  th.actions-col,
  td.actions-col {
    display: none !important;
  }
}

</style>

</head>
<body dir="rtl"></body>
<div class="container">
   <div class="header" style="text-align:center;">
     <img src="image1.png" alt="Ø´Ø¹Ø§Ø± Ø³Ù„Ø·Ù†Ø© Ø¹Ù…Ø§Ù†" class="logo" style="width:100px; display:block; margin:auto;"> 
     <h4 style="margin:0; font-size:18px; color:#556B2F;">Ù‡ÙŠØ¦Ø© Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ù…Ø³ØªÙ‡Ù„Ùƒ</h4> 
     <h6 style="margin:0; font-size:16px; color:#556B2F;">Consumer Protection Authority</h6>
      <p style="margin:0; font-size:14px; color:#556B2F;">www.cpa.gov.om</p>
       <p style="margin:0; font-size:14px; color:#556B2F;">Ø¥Ø¯Ø§Ø±Ø© Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ù…Ø³ØªÙ‡Ù„Ùƒ Ø¨Ù…Ø­Ø§ÙØ¸Ø© Ø§Ù„Ø¸Ø§Ù‡Ø±Ø©</p>
       <p style="margin:0; font-size:14px; color:#556B2F;">Ù‚Ø³Ù… ØªÙ‚Ù†ÙŠØ© Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª</p>
     </div>

     <div style="text-align:center; margin:40px 0 20px 0;"> 
      <h5 style="margin:5px 0; font-weight:600;">Ø¥Ø¬Ø±Ø§Ø¡ ØªÙˆÙÙŠØ± Ù„ÙˆØ§Ø²Ù… ØªÙ‚Ù†ÙŠØ©</h5> 
      <h4 style="margin:5px 0; font-weight:600;">Ø§Ø³ØªÙ…Ø§Ø±Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„ÙÙ†ÙŠ Ù„Ù„Ø£Ø¬Ù‡Ø²Ø© (Ù…ÙˆØ­Ø¯)</h4> 
    </div>

  <div class="search-container">
    <input type="text" id="searchInput" placeholder="ğŸ” Ø§Ø¨Ø­Ø« ÙÙŠ ÙƒÙ„ Ø§Ù„Ø­Ù‚ÙˆÙ„">
  </div>

  <input type="hidden" id="editRow">

<table id="report1Table">
  <thead>
    <tr>
      <!-- Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰: Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© -->
      <th colspan="4">Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©</th>

      <!-- Ø£Ø¹Ù…Ø¯Ø© Ù…Ù†ÙØµÙ„Ø© -->
      <th rowspan="2">ØªØ­Ø¯ÙŠØ¯ Ù†ÙˆØ¹ Ø§Ù„Ø¹Ø·Ù„ Ù…Ù† Ù…Ù‚Ø¯Ù… Ø§Ù„Ø·Ù„Ø¨</th>
      <th rowspan="2">ÙˆØµÙ Ø§Ù„Ù…Ø´ÙƒÙ„Ø© Ø§Ù„ÙÙ†ÙŠØ© Ù…Ù† Ù…Ù‚Ø¯Ù… Ø§Ù„Ø·Ù„Ø¨</th>
      <th rowspan="2">Ø±Ø¦ÙŠØ³ Ø§Ù„Ù‚Ø³Ù…</th>
      <th rowspan="2">Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù Ø§Ù„Ù…Ø®ØªØµ</th>

      <!-- Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ©: Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„ÙÙ†ÙŠ -->
     <th colspan="5">Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„ÙÙ†ÙŠ Ù…Ù† Ù…ÙˆØ¸Ù Ù‚Ø³Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª ÙˆØ§Ù„Ø¯Ø¹Ù… Ø§Ù„ÙÙ†ÙŠ</th>


      <!-- Ø£Ø¹Ù…Ø¯Ø© Ù…Ù†ÙØµÙ„Ø© ÙÙŠ Ø§Ù„Ù†Ù‡Ø§ÙŠØ© -->
      <th rowspan="2">Ø±Ø£ÙŠ Ø±Ø¦ÙŠØ³ Ø§Ù„Ù‚Ø³Ù… </th>
     <th rowspan="2" class="actions-col">Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡</th>

     
    </tr>
    <tr>
      <!-- Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© ØªØ­Øª "Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©" -->
      <th>Ø§Ø³Ù… Ù…Ù‚Ø¯Ù… Ø§Ù„Ø·Ù„Ø¨</th>
      <th>Ø§Ù„Ù‚Ø³Ù…</th>
      <th>ØªØ§Ø±ÙŠØ® ØªÙ‚Ø¯ÙŠÙ… Ø§Ù„Ø·Ù„Ø¨</th>
      <th>Ù†ÙˆØ¹ Ø§Ù„Ø¬Ù‡Ø§Ø²</th>

      <!-- Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© ØªØ­Øª "Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„ÙÙ†ÙŠ" -->
      <th>Ù‡Ù„ ØªÙ… Ø­Ù„ Ø§Ù„Ù…Ø´ÙƒÙ„Ø©ØŸ</th>
       <th>ØªØ§Ø±ÙŠØ® Ø­Ù„ Ø§Ù„Ù…Ø´ÙƒÙ„Ø©</th>
      <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ ÙˆØ§Ù„ØªÙˆØµÙŠØ§Øª</th>
      <th>Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù Ø§Ù„Ù…Ø®ØªØµ</th>
      
      <th> Ø±Ø¦ÙŠØ³ Ø§Ù„Ù‚Ø³Ù…</th>
      
    </tr>
  </thead>
  <tbody></tbody>
</table>


  <div class="buttons">
    <button onclick="printReport()">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ±</button>
   <button onclick="exportToExcel()">ØªØµØ¯ÙŠØ± Excel</button>
    <button type="button" onclick="window.location.href='support.html'">
  Ø§Ù„Ø±Ø¬ÙˆØ¹
</button>

  </div>
</div>
 <div class="footer-meta">
  <div>Ø§Ù„Ø±Ù…Ø²: SOP-079-03</div>
  <div>Ø§Ù„Ø¥ØµØ¯Ø§Ø±: 02 | Ø§Ù„ØªØ§Ø±ÙŠØ®: ÙŠÙˆÙ„ÙŠÙˆ 2024</div>
</div>


<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
<script>

const scriptURL = 'https://script.google.com/macros/s/AKfycbwPowkz1zHVl87A0QP5POlK87KLrnhL1Xyey5qjWbGl2x9LYkiSbdKrrPFYv1otleXb4g/exec';


function loadReports() {
  fetch(scriptURL + '?action=getReports&t=' + Date.now())
    .then(res => res.json())
    .then(rows => {
      const tbody = document.querySelector('#report1Table tbody');
      tbody.innerHTML = '';
     


      rows.forEach(r => {
        const tr = document.createElement('tr');

        tr.innerHTML = `
          <td>${r["Ø§Ø³Ù… Ù…Ù‚Ø¯Ù… Ø§Ù„Ø·Ù„Ø¨"] || ''}</td>
          <td>${r["Ø§Ù„Ù‚Ø³Ù…"] || ''}</td>
          <td>${formatDate(r["ØªØ§Ø±ÙŠØ® ØªÙ‚Ø¯ÙŠÙ… Ø§Ù„Ø·Ù„Ø¨"])}</td>
          <td>${r["Ù†ÙˆØ¹ Ø§Ù„Ø¬Ù‡Ø§Ø²"] || ''}</td>
          <td>${r["ØªØ­Ø¯ÙŠØ¯ Ù†ÙˆØ¹ Ø§Ù„Ø¹Ø·Ù„ Ù…Ù† Ù…Ù‚Ø¯Ù… Ø§Ù„Ø·Ù„Ø¨"] || ''}</td>
          <td>${r["ÙˆØµÙ Ø§Ù„Ù…Ø´ÙƒÙ„Ø© Ø§Ù„ÙÙ†ÙŠØ© Ù…Ù† Ù…Ù‚Ø¯Ù… Ø§Ù„Ø·Ù„Ø¨"] || ''}</td>
          <td>${r["Ø±Ø¦ÙŠØ³ Ø§Ù„Ù‚Ø³Ù…"] || ''}</td>
          <td>${r["Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù Ø§Ù„Ù…Ø®ØªØµ"] || ''}</td>
          <td>${r["Ù‡Ù„ ØªÙ… Ø­Ù„ Ø§Ù„Ù…Ø´ÙƒÙ„Ø©ØŸ"] || ''}</td>
          <td>${formatDate(r["ØªØ§Ø±ÙŠØ® Ø­Ù„ Ø§Ù„Ù…Ø´ÙƒÙ„Ø©"])}</td>
          <td>${r["Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ ÙˆØ§Ù„ØªÙˆØµÙŠØ§Øª"] || ''}</td>
          <td>${r["Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù Ø§Ù„Ù…Ø®ØªØµ (Ø§Ù„ØªÙ‚Ø±ÙŠØ±)"] || ''}</td>
          <td>${r["Ø±Ø¦ÙŠØ³ Ø§Ù„Ù‚Ø³Ù… (Ø§Ù„ØªÙ‚Ø±ÙŠØ±)"] || ''}</td>
          <td>${r["Ø±Ø£ÙŠ Ø±Ø¦ÙŠØ³ Ø§Ù„Ù‚Ø³Ù…"] || ''}</td>

         <td class="actions-col">
    <button class="btn-edit"  data-row="${r.row}">âœï¸ ØªØ¹Ø¯ÙŠÙ„</button>
    <button class="btn-delete" data-row="${r.row}">ğŸ—‘ï¸ Ø­Ø°Ù</button>
  </td>
`;

        tbody.appendChild(tr);
      });
    })
    .catch(err => console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', err));
}
function deleteByRow_(d) {
  const sh = sheet_();
  const rowNum = Number(d.row);

  if (!rowNum || rowNum < 2) {
    return { status: "error", message: "Ø±Ù‚Ù… Ø§Ù„ØµÙ ØºÙŠØ± ØµØ­ÙŠØ­" };
  }

  sh.deleteRow(rowNum);
  return { status: "success" };
}

document.addEventListener("click", (e) => {
  const deleteBtn = e.target.closest(".btn-delete");
  if (!deleteBtn) return;
  const row = deleteBtn.dataset.row;
  deleteByRow(row);
});


function deleteByRow(row) {
  const rowNum = String(row || "").trim();
  if (!rowNum) {
    alert("Ø±Ù‚Ù… Ø§Ù„ØµÙ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙØŒ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„Ø­Ø°Ù.");
    return;
  }

  if (!confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø³Ø¬Ù„ (ØµÙ Ø±Ù‚Ù… ${rowNum})ØŸ`)) return;

  const data = {
    action: "deleteByRow",
    row: rowNum
  };

  fetch(scriptURL, {
    method: 'POST',
    mode: 'no-cors',
    headers: { 'Content-Type': 'text/plain;charset=utf-8' },
    body: JSON.stringify(data)
  })
  .then(() => {
    // Ù…Ø§ Ù†Ù‚Ø¯Ø± Ù†Ù‚Ø±Ø£ Ø§Ù„Ø±Ø¯ Ù…Ø¹ no-corsØŒ Ù„ÙƒÙ† Ù†ÙØªØ±Ø¶ Ø£Ù† Ø§Ù„Ø­Ø°Ù ØªÙ… Ø¨Ù†Ø¬Ø§Ø­
    alert("ØªÙ… Ø­Ø°Ù Ø§Ù„Ø³Ø¬Ù„ Ø¨Ù†Ø¬Ø§Ø­ âœ…");
    loadReports(); // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¬Ø¯ÙˆÙ„
  })
  .catch(err => {
    console.error("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­Ø°Ù:", err);
    alert("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­Ø°ÙØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.");
  });
}


document.addEventListener("click", (e) => {
  const editBtn   = e.target.closest(".btn-edit");
  const deleteBtn = e.target.closest(".btn-delete");

  // âœï¸ ØªØ¹Ø¯ÙŠÙ„
  if (editBtn) {
    const row = editBtn.dataset.row;
    if (!row) return;

    localStorage.setItem('editRow', row);
    window.location.href = 'index.html'; // Ù…Ø³Ø§Ø± ØµÙØ­Ø© Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
    return;
  }

  // ğŸ—‘ï¸ Ø­Ø°Ù
  if (deleteBtn) {
    const row = deleteBtn.dataset.row;
    deleteByRow(row);
    return;
  }
});



document.addEventListener('DOMContentLoaded', loadReports);

function startEdit(row) {
  const rowNum = Number(row);
  if (!rowNum) return;

  fetch(scriptURL + '?action=getReports&t=' + Date.now())
    .then(res => res.json())
    .then(rows => {
      const record = rows.find(r => r.row === rowNum);
      if (!record) {
        alert("Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ Ù„Ù„ØªØ¹Ø¯ÙŠÙ„");
        return;
      }

      // Ø¯Ø§Ù„Ø© ØµØºÙŠØ±Ø© Ø¢Ù…Ù†Ø© Ù„Ø¶Ø¨Ø· Ø§Ù„Ù‚ÙŠÙ…Ø© Ø¥Ø°Ø§ ÙˆÙØ¬Ø¯ Ø§Ù„Ø¹Ù†ØµØ±
      function safeSet(id, value) {
        const el = document.getElementById(id);
        if (el) el.value = value || "";
      }

      // Ù†Ø®Ø²Ù† Ø±Ù‚Ù… Ø§Ù„ØµÙ ÙÙŠ Ø§Ù„Ø­Ù‚Ù„ Ø§Ù„Ù…Ø®ÙÙŠ (Ù„Ùˆ Ù…ÙˆØ¬ÙˆØ¯)
      safeSet("editRow", rowNum);

      // ğŸ”¹ ØªØ¹Ø¨Ø¦Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù‚Ø¯Ù… Ø§Ù„Ø·Ù„Ø¨ (Ù„Ùˆ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ù…ÙˆØ¬ÙˆØ¯Ø© ÙÙŠ Ø§Ù„ØµÙØ­Ø©)
      safeSet('applicantName',      record["Ø§Ø³Ù… Ù…Ù‚Ø¯Ù… Ø§Ù„Ø·Ù„Ø¨"]);
      safeSet('department',         record["Ø§Ù„Ù‚Ø³Ù…"]);
      safeSet('requestDate',        record["ØªØ§Ø±ÙŠØ® ØªÙ‚Ø¯ÙŠÙ… Ø§Ù„Ø·Ù„Ø¨"]);
      safeSet('deviceType',         record["Ù†ÙˆØ¹ Ø§Ù„Ø¬Ù‡Ø§Ø²"]);
      safeSet('problemDescription', record["ÙˆØµÙ Ø§Ù„Ù…Ø´ÙƒÙ„Ø© Ø§Ù„ÙÙ†ÙŠØ© Ù…Ù† Ù…Ù‚Ø¯Ù… Ø§Ù„Ø·Ù„Ø¨"]);

      // ğŸ”¹ ØªØ¹Ø¨Ø¦Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„ÙÙ†ÙŠ (Ù„Ùˆ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ù…ÙˆØ¬ÙˆØ¯Ø©)
      safeSet('solutionResolved',       record["Ù‡Ù„ ØªÙ… Ø­Ù„ Ø§Ù„Ù…Ø´ÙƒÙ„Ø©ØŸ"] || "Ù„Ø§");
      safeSet('solutionDate',           record["ØªØ§Ø±ÙŠØ® Ø­Ù„ Ø§Ù„Ù…Ø´ÙƒÙ„Ø©"]);
      safeSet('actionsRecommendations', record["Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ ÙˆØ§Ù„ØªÙˆØµÙŠØ§Øª"]);
      safeSet('techName',               record["Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù Ø§Ù„Ù…Ø®ØªØµ (Ø§Ù„ØªÙ‚Ø±ÙŠØ±)"]);
      safeSet('headOpinion',            record["Ø±Ø£ÙŠ Ø±Ø¦ÙŠØ³ Ø§Ù„Ù‚Ø³Ù…"]);

      // ğŸ”¹ ØªØ¹Ø¨Ø¦Ø© Ù†ÙˆØ¹ Ø§Ù„Ø¹Ø·Ù„ ÙÙŠ Ø§Ù„Ø±Ø§Ø¯ÙŠÙˆ (ÙÙ‚Ø· Ù„Ùˆ Ø§Ù„Ø±Ø§Ø¯ÙŠÙˆ Ù…ÙˆØ¬ÙˆØ¯)
      const faultValue = record["ØªØ­Ø¯ÙŠØ¯ Ù†ÙˆØ¹ Ø§Ù„Ø¹Ø·Ù„ Ù…Ù† Ù…Ù‚Ø¯Ù… Ø§Ù„Ø·Ù„Ø¨"] || "";
      if (faultValue) {
        const faultRadio = document.querySelector(`input[name="faultType"][value="${faultValue}"]`);
        if (faultRadio) faultRadio.checked = true;
      }

      // ğŸ”¹ Ø³ÙƒØ±ÙˆÙ„ Ù„Ù„Ù†Ù…ÙˆØ°Ø¬ (Ù„Ùˆ techForm Ù…ÙˆØ¬ÙˆØ¯)
      const techFormEl = document.getElementById('techForm');
      if (techFormEl) {
        techFormEl.scrollIntoView({ behavior: 'smooth' });
      }
    })
    .catch(err => {
      console.error("Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ù„Ù„ØªØ¹Ø¯ÙŠÙ„:", err);
      alert("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø³Ø¬Ù„ Ù„Ù„ØªØ¹Ø¯ÙŠÙ„.");
    });
}



// ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ØªØ§Ø±ÙŠØ®
function formatDate(s) {
  const date = parseDateLocal(s);
  if (isNaN(date)) return s || '';
  
  const dd = String(date.getDate()).padStart(2, '0');
  const mm = String(date.getMonth() + 1).padStart(2, '0');
  const yyyy = date.getFullYear();
  return `${dd}/${mm}/${yyyy}`;
}

// ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù†Øµ Ø¥Ù„Ù‰ ÙƒØ§Ø¦Ù† Date Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­ Ù…Ø¹ Ù…Ø±Ø§Ø¹Ø§Ø© Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø²Ù…Ù†ÙŠØ©
function parseDateLocal(s) {
  if (!s) return NaN;
  s = String(s).trim();
  if (!s) return NaN;

  // 1) Ù„Ùˆ Ø§Ù„ØªØ§Ø±ÙŠØ® Ø¬Ø§ÙŠ Ø¨ØµÙŠØºØ© ISO ÙˆÙ…Ø¹Ù‡ T (Ù…Ø«Ù„ 2025-12-08T20:00:00.000Z)
  // Ù†Ø®Ù„ÙŠÙ‡ ÙƒÙ…Ø§ Ù‡Ùˆ ÙˆÙ†Ø®Ù„ÙŠÙ‡ Ù„Ù€ new Date Ù…Ø¨Ø§Ø´Ø±Ø©
  if (s.includes('T')) {
    const d = new Date(s);  // Ø§Ù„Ù…ØªØµÙØ­ ÙŠØ­ÙˆÙ„Ù‡ Ù„ØªØ§Ø±ÙŠØ® Ù…Ø­Ù„ÙŠ
    return isNaN(d) ? NaN : d;
  }

  // 2) yyyy-mm-dd (Ø¨Ø¯ÙˆÙ† ÙˆÙ‚Øª)
  let m = s.match(/^(\d{4})-(\d{2})-(\d{2})$/);
  if (m) return new Date(+m[1], +m[2] - 1, +m[3]);

  // 3) dd/mm/yyyy Ø£Ùˆ dd-mm-yyyy
  m = s.match(/^(\d{1,2})[\/\-](\d{1,2})[\/\-](\d{2,4})$/);
  if (m) {
    const dd = +m[1],
          mm = +m[2],
          yyyy = m[3].length === 2 ? +('20' + m[3]) : +m[3];
    return new Date(yyyy, mm - 1, dd);
  }

  return NaN;
}

// Ø¨Ø­Ø« Ø¹Ø§Ù… ÙÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„ (Ù„Ùˆ Ø¹Ù†Ø¯Ùƒ input#searchInput)
const searchInput = document.getElementById("searchInput");
if (searchInput) {
  searchInput.addEventListener("input", function () {
    const filter = this.value.toLowerCase();
    const rows = document.querySelectorAll("#report1Table tbody tr");
    rows.forEach(row => {
      const match = Array.from(row.children).some(cell =>
        cell.textContent.toLowerCase().includes(filter)
      );
      row.style.display = match ? "" : "none";
    });
  });
}

// Ø·Ø¨Ø§Ø¹Ø©
function printReport() {
  window.print();
}


// Ø±Ø¬ÙˆØ¹
function goBack() {
  window.history.back();
}

function exportToExcel() {
  if (typeof XLSX === "undefined") {
    alert("Ù…ÙƒØªØ¨Ø© XLSX ØºÙŠØ± Ù…Ø­Ù…Ù‘Ù„Ø©. Ø£Ø¶Ù SheetJS Ø£ÙˆÙ„Ø§Ù‹.");
    return;
  }

  const table = document.getElementById("report1Table");
  if (!table) {
    alert("Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ø¬Ø¯ÙˆÙ„ report1Table");
    return;
  }

  // Ù†Ø­ÙˆÙ„ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø¥Ù„Ù‰ sheet
  const ws = XLSX.utils.table_to_sheet(table, { raw: true });

  // Ù†Ø­Ø°Ù Ø¹Ù…ÙˆØ¯ "Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡" (Ø¢Ø®Ø± Ø¹Ù…ÙˆØ¯) Ù„Ø£Ù†Ù‡ ÙŠØ­ØªÙˆÙŠ Ø£Ø²Ø±Ø§Ø±
  let range = XLSX.utils.decode_range(ws["!ref"]);
  const actionColIndex = range.e.c; // Ø¢Ø®Ø± Ø¹Ù…ÙˆØ¯ ÙÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„

  for (let r = range.s.r; r <= range.e.r; r++) {
    const addr = XLSX.utils.encode_cell({ r, c: actionColIndex });
    if (ws[addr]) delete ws[addr];
  }

  // Ù†Ø­Ø¯Ù‘Ø« Ù†Ø·Ø§Ù‚ Ø§Ù„Ø´ÙŠØª Ù„ÙŠÙƒÙˆÙ† Ø¨Ø¯ÙˆÙ† Ø¹Ù…ÙˆØ¯ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡
  range.e.c = range.e.c - 1;
  ws["!ref"] = XLSX.utils.encode_range(range);

  // Ø¶Ø¨Ø· Ø¹Ø±Ø¶ Ø£Ø¹Ù…Ø¯Ø© Ø¨Ø´ÙƒÙ„ Ù…Ù†Ø§Ø³Ø¨
  const colCount = range.e.c - range.s.c + 1;
  ws["!cols"] = Array.from({ length: colCount }, () => ({ wch: 22 }));

  // Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ù Excel
  const wb = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb, ws, "Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„ÙÙ†ÙŠ Ù„Ù„Ø£Ø¬Ù‡Ø²Ø©");

  const today = new Date().toISOString().slice(0, 10);
  XLSX.writeFile(wb, `technical_reports_${today}.xlsx`);
}

// (Ø§Ø®ØªÙŠØ§Ø±ÙŠ) Ù…Ù†Ø¹ ÙƒÙ„ÙŠÙƒ ÙŠÙ…ÙŠÙ† + Ø§Ø®ØªØµØ§Ø±Ø§Øª
  document.addEventListener('contextmenu', e => e.preventDefault());
  document.addEventListener('keydown', function (e) {
    if (e.key === 'F12') e.preventDefault();
    if (e.ctrlKey && e.shiftKey && ['I','J','C'].includes(e.key.toUpperCase())) e.preventDefault();
    if (e.ctrlKey && e.key.toUpperCase() === 'U') e.preventDefault();
  });
 
   document.getElementById('year').textContent = new Date().getFullYear();


</script>
</body>
</html>
